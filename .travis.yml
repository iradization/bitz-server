sudo: false
language: generic

cache:
  apt: true

matrix:
  include:
    - os: linux
      env: CXX=g++-5 CC=gcc-5
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
    - os: linux
      env: CXX=clang++-6.0 CC=clang-6.0
      compiler: clang
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-6.0
          packages:
            - clang-6.0
    - os: osx
      compiler: gcc
      env: CXX=g++ CC=gcc
    - os: osx
      compiler: clang
      env: CXX=clang++ CC=clang

before_install:
  - echo $LANG
  - echo $LC_ALL
  - echo `$CXX --version`

install:
  - curl -L https://github.com/nukedzn/psocksxx/releases/download/v1.1.1/psocksxx-1.1.1.tar.gz | tar -zx -C /tmp
  - cd /tmp/psocksxx-* && ./configure --prefix=/tmp/root && make && make install
  - if [ $TRAVIS_OS_NAME == linux ]; then curl -L http://www.hyperrealm.com/packages/libconfig-1.4.10.tar.gz | tar -zx -C /tmp; fi
  - if [ $TRAVIS_OS_NAME == linux ]; then cd /tmp/libconfig-* && ./configure --prefix=/tmp/root && make && make install; fi
  - if [ $TRAVIS_OS_NAME == osx ]; then brew update && brew install libconfig; fi
  - cd ${TRAVIS_BUILD_DIR}

before_script:
  - PKG_CONFIG_PATH=/tmp/root/lib/pkgconfig cmake -H. -Bbuild -DBUILD_SHARED_LIBS=ON -DCMAKE_BUILD_TYPE=Release

script:
  - cmake --build build

